---
title: "[GitHub Blog] TIL 50"

writer: ysooj
categories:
- GitHub Blog
tags: [Blog, jekyll, Github, Git, markdown, TIL]

toc: true
toc_sticky: true

date: 2024-11-27
---

#### **ì´ì „ ëŒ€í™”ë‚´ìš©ì—ì„œ quizë§Œ ë¶ˆëŸ¬ì˜¤ê¸°**

quiz ì¤‘ì—ì„œë„ ë³´ê¸°ë¥¼ ì œì™¸í•˜ê³  ì§ˆë¬¸ ë¶€ë¶„ë§Œ ì¶”ì¶œí•´ì˜¤ê¸° ìœ„í•´ì„œ, íŠ¹ì • íŒ¨í„´ë§Œ ì¶”ì¶œí•˜ë„ë¡ ì •ê·œì‹ì„ ì‚¬ìš©í–ˆë‹¤. Â 

```
# 'í€´ì¦ˆ:'ë¡œ ì‹œì‘í•˜ëŠ” ë‚´ìš©ë§Œ ì¶”ì¶œ
quiz_pattern = r"í€´ì¦ˆ: .*"
quiz_onlys = re.findall(quiz_pattern, previous_conversation)
```

quiz\_onlysë¥¼ forë¬¸ìœ¼ë¡œ í•˜ë‚˜ ì”© ì¶œë ¥í•´ì„œ ì§ˆë¬¸ ë¶€ë¶„ë§Œ ì¶”ì¶œë˜ì—ˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```
# í•„ìš”í•œ ë¶€ë¶„ ì¶œë ¥
print("ì¶”ì¶œëœ í€´ì¦ˆ:")
for quiz_only in quiz_onlys:
    print(quiz_only)
```

feedback\_promptì— 'ëŒ€í™” ê¸°ë¡' ë¶€ë¶„ì— ë¶ˆëŸ¬ì˜¤ëŠ” ë‚´ìš©ê³¼ ëª¨ë¸ì— ì „ë‹¬í•˜ëŠ” ë°ì´í„°ë¥¼ previous\_conversationì—ì„œ quiz\_onlysë¡œ ìˆ˜ì •í–ˆë‹¤.

```
# 3. ì‚¬ìš©ì ë‹µë³€ì— ëŒ€í•œ í”¼ë“œë°± ìƒì„±
feedback_prompt = ChatPromptTemplate.from_messages([
    ("system", f"""
AI ê°•ì‚¬ë¡œì„œ ë‹¤ìŒ í€´ì¦ˆì˜ ì •ë‹µ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³  í”¼ë“œë°±ì„ ì œê³µí•˜ì„¸ìš”.
í€´ì¦ˆ: {{quiz}}
ë‹µë³€: {{answer}}
ëŒ€í™” ê¸°ë¡: {{quiz_onlys}}
ê±°ì ˆ ì‚¬ìœ : {{refusal}}
""")
])


# í”¼ë“œë°± ìƒì„± - í‚¤ì›Œë“œ ì¸ìˆ˜ë¡œ ì „ë‹¬
feedback_data = feedback_prompt.format(
    quiz=quiz,
    answer=user_answer,
    quiz_onlys=quiz_onlys,
    refusal="None"
)
```

ì•„ë˜ì˜ ì½”ë“œë¥¼ í†µí•´ quiz\_onlysê°€ ì˜ ì „ë‹¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```
# format ê²°ê³¼ë¥¼ í™•ì¸
    print("Formatted Feedback Data:")
    print(feedback_data)
```

---

ê¹ƒí—ˆë¸Œì— commitì„ ì˜¬ë ¸ê³ , ì¡°ì¥ë‹˜ì˜ í”¼ë“œë°±ì„ ë°›ì•˜ë‹¤. í”¼ë“œë°±ì„ ë°”íƒ•ìœ¼ë¡œ ì½”ë“œë¥¼ ìˆ˜ì •í–ˆë‹¤.

```
quiz_list = []


# ëŒ€í™” ì§„í–‰
while True:
    # 1. í€´ì¦ˆ ìƒì„±
    quiz = rag_chain.invoke("í€´ì¦ˆë¥¼ ì‹œì‘í•˜ì„¸ìš”.")
# 'í€´ì¦ˆ:'ë¡œ ì‹œì‘í•˜ëŠ” ë‚´ìš©ë§Œ ì¶”ì¶œ
    quiz_pattern = r"í€´ì¦ˆ: .*"
    all_quizzes = "\n".join(quiz_list)  # ë¦¬ìŠ¤íŠ¸ë¥¼ ë¬¸ìì—´ë¡œ ê²°í•©
    quiz_onlys = re.findall(quiz_pattern, all_quizzes)  # ë¬¸ìì—´ì—ì„œ ê²€ìƒ‰
```

quizì˜ ì§ˆë¬¸ ë¶€ë¶„ ë‚´ìš©ì„ ì¶”ì¶œí•´ì˜¤ëŠ” ê³³ì„ previous\_conversationì—ì„œ quiz\_listë¡œ ë°”ê¿¨ë‹¤.

```
# 'í€´ì¦ˆ:'ë¡œ ì‹œì‘í•˜ëŠ” ë‚´ìš©ë§Œ ì¶”ì¶œ
quiz_pattern = r"í€´ì¦ˆ: .*"
all_quizzes = "\n".join(quiz_list)  # ë¦¬ìŠ¤íŠ¸ë¥¼ ë¬¸ìì—´ë¡œ ê²°í•©
quiz_onlys = re.findall(quiz_pattern, all_quizzes)  # ë¬¸ìì—´ì—ì„œ ê²€ìƒ‰
```

---

### Â **Streamlitìœ¼ë¡œ ui êµ¬í˜„í•˜ê¸°**

streamlitìœ¼ë¡œ ê°„ë‹¨í•œ ì±„íŒ…ì„ í•  ìˆ˜ ìˆëŠ” ì±—ë´‡ì„ êµ¬í˜„í–ˆë‹¤.

```
import openai
import streamlit as st
from dotenv import load_dotenv
import os

load_dotenv()

# í˜ì´ì§€ êµ¬ì„±
st.set_page_config(
    page_title='ë³µìŠµ í€´ì¦ˆ ì±—ë´‡',
    page_icon='ğŸ¤–',
    layout='wide',
    initial_sidebar_state='auto'
)

# ì±—ë´‡ ì´ë¦„ ê¾¸ë¯¸ê¸°
st.markdown(
    """
    <style>
    .custom-title {
        color: #008080;
        font-size: 30px;
        font-weight: bold;
    }
    </style>
    """,
    unsafe_allow_html=True,
)
st.markdown('<p class="custom-title">ë³µìŠµ í€´ì¦ˆ ì±—ë´‡ğŸ“–</p>', unsafe_allow_html=True)

# ì‚¬ì´ë“œë°” êµ¬ì„±í•˜ê¸°
theme = st.sidebar.selectbox('ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”.', ['íŒŒì´ì¬ ë¼ì´ë¸ŒëŸ¬ë¦¬', 'ë¨¸ì‹ ëŸ¬ë‹', 'ë”¥ëŸ¬ë‹', 'LLM, RAG', 'AI í™œìš©'])
st.write(f'{theme}ì— ëŒ€í•œ í€´ì¦ˆë¥¼ ë‚´ë³´ê² ìŠµë‹ˆë‹¤!')


# .env íŒŒì¼ì—ì„œ api í‚¤ ê°€ì ¸ì˜¤ê¸°
API_KEY = os.getenv('openai_api_key')

# OpenAI API í‚¤ ì„¤ì •
if API_KEY:
    openai.api_key = API_KEY
else:
    st.error("API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. .env íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.")
    st.stop()

@st.cache_data  # ìƒˆë¡œê³ ì¹¨í•˜ë©´ ëŒ€í™” ë‚´ì—­ì´ ì‚¬ë¼ì§
# @st.cache_resource  # ìƒˆë¡œê³ ì¹¨í•´ë„ ëŒ€í™” ë‚´ì—­ì´ ë‚¨ì•„ìˆìŒ
def start_chat_session():
    # ì±„íŒ… ê¸°ë¡ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
    return []

if "chat_session" not in st.session_state:
    st.session_state["chat_session"] = start_chat_session()

# ê¸°ì¡´ ì±„íŒ… ê¸°ë¡ í‘œì‹œ
for content in st.session_state.chat_session:
    with st.chat_message("ai" if content["role"] == "assistant" else "user"):
        st.markdown(content["content"])

# ì‚¬ìš©ì ì…ë ¥ ë°›ê¸°
if prompt := st.chat_input("ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”."):
    with st.chat_message("user"):
        st.markdown(prompt)
        # ì‚¬ìš©ìì˜ ì…ë ¥ì„ ì±„íŒ… ê¸°ë¡ì— ì¶”ê°€
        st.session_state.chat_session.append({"role": "user", "content": prompt})

    # GPT ëª¨ë¸ë¡œë¶€í„° ì‘ë‹µ ë°›ê¸°
    with st.chat_message("ai"):
        response = openai.ChatCompletion.create(
            model="gpt-4",  # ì‚¬ìš©í•  ëª¨ë¸ ì§€ì • (gpt-4 ë˜ëŠ” gpt-3.5-turbo ë“±)
            messages=st.session_state.chat_session
        )
        # GPTì˜ ì‘ë‹µ í…ìŠ¤íŠ¸
        reply = response["choices"][0]["message"]["content"]
        st.markdown(reply)
        # ì‘ë‹µì„ ì±„íŒ… ê¸°ë¡ì— ì¶”ê°€
        st.session_state.chat_session.append({"role": "assistant", "content": reply})
```

ìš°ë¦¬ê°€ ë§Œë“  ì±—ë´‡ê³¼ ì—°ê²°ì‹œì¼œì•¼ í•œë‹¤.